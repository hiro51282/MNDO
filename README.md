# AI連携マインドマップエディタ

React + ReactFlow + GPTを使用した、AI連携機能付きマインドマップエディタです。直感的な操作でマインドマップを作成し、AIアシスタントの力を借りてアイデアを拡張できます。

## 🚀 機能一覧

### 基本機能
- **ノード操作**: ノードの追加、編集、削除
- **エッジ管理**: ノード間の接続とスタイル変更
- **複数選択**: Ctrlキーで複数ノードを選択
- **レイアウト**: 縦方向・横方向のレイアウト切り替え
- **スタイリング**: ノードの色変更、エッジの線種変更

### AI連携機能
- **自然言語入力**: 自由なテキスト入力でAIに指示
- **提案モード**: AIが点線のノード・エッジで提案
- **確定/破棄機能**: ユーザーが提案を了承または破棄
- **リアルタイム処理**: 入力と同時にAIが処理を実行
- **視覚的フィードバック**: 提案状態の明確な表示

### 保存・読み込み機能
- **JSON形式保存**: マインドマップをJSONファイルとして保存
- **状態復元**: ノード、エッジ、レイアウト、色設定を完全復元
- **エラーハンドリング**: 保存失敗時の代替手段（クリップボード、コンソール出力）

### キーボードショートカット
- **Tab**: 選択中のノードにサブノードを追加
- **Ctrl**: 複数選択モード

## 🤖 AIアシスタント機能詳細

### 概要
AIアシスタントは、ユーザーの自然言語入力に基づいてマインドマップの拡張を提案する機能です。従来の固定形式ではなく、自由なテキスト入力に対応し、提案モードでユーザーの意思決定をサポートします。

### 主要特徴

#### 1. 自由な自然言語入力
- **柔軟な指示**: 「メインサブアイデアにノードを2つ追加して」
- **会話内容のノード化**: 「会話の内容をノードに追加する」
- **汎用的な提案**: 「新しいアイデアを提案してください」
- **日本語対応**: 完全な日本語入力に対応

#### 2. 提案モードシステム
- **視覚的提案**: AI提案は点線のノード・エッジで表示
- **状態管理**: 提案中/確定済みの明確な区別
- **確定/破棄**: ユーザーの意思決定をサポート
- **リアルタイム更新**: 提案の確定により即座に実線に変更

#### 3. 提案の種類

##### ノード追加提案
```
入力: "メインサブアイデアにノードを2つ追加して"
結果: 
- 2つの新しいノードを点線で提案
- 既存ノードとの接続を提案
- 適切な位置に配置
```

##### 会話内容ノード化
```
入力: "会話の内容をノードに追加する"
結果:
- 会話内容を要約したノードを提案
- 関連する既存ノードとの接続を提案
```

##### 汎用提案
```
入力: "新しいアイデアを提案してください"
結果:
- 入力内容に基づく汎用的なノードを提案
- 現在のマインドマップ構造を考慮
```

### 技術実装

#### アーキテクチャ
```typescript
interface AiProposal {
  id: string;           // 提案の一意識別子
  nodes: Node[];        // 提案するノード
  edges: Edge[];        // 提案するエッジ
  description: string;  // 提案の説明
  timestamp: number;    // 提案生成時刻
}
```

#### 状態管理
- **提案状態**: `isProposal: true/false`
- **提案ID**: `proposalId: string`
- **視覚的状態**: 点線/実線、色の違い
- **処理状態**: 処理中/完了/エラー

#### 視覚的フィードバック
- **提案ノード**: 点線枠線 + 薄い背景色
- **提案エッジ**: 点線 + 特別な色
- **確定後**: 実線 + 通常の背景色
- **処理中**: スピナーアニメーション

### 使用方法

#### 基本操作フロー
1. **入力**: 左下のAIアシスタントにテキストを入力
2. **提案**: 「提案」ボタンをクリック
3. **確認**: 点線のノード・エッジが表示される
4. **決定**: 「✅ 確定」または「❌ 破棄」を選択

#### 入力例と結果
| 入力例 | 提案内容 |
|--------|----------|
| 「メインサブアイデアにノードを2つ追加して」 | 2つの新しいノードと接続を提案 |
| 「会話の内容をノードに追加する」 | 会話内容を要約したノードを提案 |
| 「新しいアイデアを提案してください」 | 汎用的なアイデアノードを提案 |

### 現在の実装状況

#### ✅ 実装済み機能
- **基本提案システム**: 点線ノード・エッジの表示
- **確定/破棄機能**: ユーザーの意思決定サポート
- **視覚的フィードバック**: 提案状態の明確な表示
- **エラーハンドリング**: 処理失敗時の対応
- **UI/UX**: モダンなデザインとアニメーション

#### 🔄 現在の制限事項
- **シミュレーションモード**: 実際のAI APIは未接続
- **固定提案**: 入力内容に応じた動的な提案生成は限定的
- **位置計算**: ノードの配置がランダム
- **コンテキスト理解**: 既存のマインドマップ構造の深い理解は未実装

## 🔮 今後の展開予定

### 短期目標（1-2ヶ月）

#### 1. 実際のAI API連携
- **OpenAI GPT-4 API**: 本格的なAI連携の実装
- **プロンプトエンジニアリング**: 効果的な指示文の最適化
- **レスポンス解析**: AI応答の構造化処理
- **エラーハンドリング**: API制限やネットワークエラーの対応

#### 2. 高度な提案生成
- **コンテキスト理解**: 既存のマインドマップ構造の分析
- **適切な位置計算**: レイアウトに基づく最適配置
- **関連性分析**: ノード間の意味的関連性の考慮
- **多様な提案**: ノード追加、構造変更、内容改善など

#### 3. 対話型AI
- **継続的対話**: 複数回のやり取りによる詳細化
- **質問応答**: マインドマップに関する質問への回答
- **改善提案**: 既存構造の改善提案
- **説明機能**: ノードやエッジの説明生成

### 中期目標（3-6ヶ月）

#### 1. 高度なAI機能
- **画像認識**: 手書きノードの文字認識
- **音声入力**: 音声による指示入力
- **多言語対応**: 英語、中国語など多言語サポート
- **感情分析**: ノード内容の感情分析

#### 2. コラボレーション機能
- **複数ユーザー**: リアルタイム共同編集
- **AIファシリテーター**: 会議のファシリテーション支援
- **意見統合**: 複数意見の自動統合
- **投票システム**: 提案への投票機能

#### 3. 学習機能
- **ユーザー学習**: 個人の使用パターンの学習
- **組織学習**: チームの知識ベース構築
- **ベストプラクティス**: 効果的なマインドマップ作成の提案
- **テンプレート生成**: 頻出パターンのテンプレート化

### 長期目標（6ヶ月以上）

#### 1. エンタープライズ機能
- **大規模データ**: 数千ノードのマインドマップ対応
- **セキュリティ**: 企業レベルのセキュリティ機能
- **統合機能**: 他のビジネスツールとの連携
- **分析機能**: マインドマップの分析・レポート機能

#### 2. 高度なAI統合
- **マルチモーダルAI**: テキスト、画像、音声の統合処理
- **予測機能**: 将来の展開予測
- **自動最適化**: マインドマップ構造の自動最適化
- **知識グラフ**: 外部知識ベースとの連携

#### 3. プラットフォーム化
- **API提供**: 外部アプリケーション向けAPI
- **プラグインシステム**: サードパーティ拡張機能
- **マーケットプレイス**: テンプレート・プラグインの共有
- **コミュニティ**: ユーザーコミュニティの構築

## 🛠️ 技術スタック

- **フロントエンド**: React 18 + TypeScript
- **ビルドツール**: Vite
- **マインドマップ**: ReactFlow
- **状態管理**: Zustand
- **スタイリング**: TailwindCSS
- **AI連携**: OpenAI GPT API（予定）
- **アーキテクチャ**: カスタムフック + コンポーネント分割

## 📦 インストール

```bash
# リポジトリをクローン
git clone <repository-url>
cd mndo

# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev
```

## 🔧 環境設定

### 必要な環境変数
```env
VITE_OPENAI_API_KEY=your_openai_api_key_here
```

### 依存関係
```json
{
  "react": "^18.2.0",
  "react-dom": "^18.2.0",
  "reactflow": "^11.10.1",
  "zustand": "^4.4.7",
  "tailwindcss": "^3.3.6"
}
```

## 🎮 操作方法

### 基本操作

#### ノード操作
1. **ノード追加**: 左上の「➕ 追加」ボタンをクリック
2. **ノード編集**: ノードをダブルクリックしてテキストを編集
3. **ノード削除**: ノードを右クリック → 「削除」を選択
4. **ノード選択**: ノードをクリック（Ctrlキーで複数選択）

#### エッジ操作
1. **エッジ作成**: ノードのハンドルをドラッグして別のノードに接続
2. **エッジ選択**: エッジをクリック
3. **エッジスタイル変更**: エッジを選択後、左上のエッジスタイルボタンで変更

#### レイアウト設定
1. **生成スタイル**: 左上の「生成スタイル」ドロップダウンで選択
   - 📏 縦方向: ノードが縦に配置
   - ↔️ 横方向: ノードが横に配置

#### スタイリング
1. **ノード色変更**: 
   - ノードを選択
   - カラーピッカーで色を選択
   - 「🎨 変更」ボタンをクリック
2. **エッジスタイル変更**:
   - エッジを選択
   - 「━ 通常」「┅ 破線」「⋯ 点線」ボタンで変更

### AI連携操作

#### AIアシスタント使用
1. **入力ボックス**: 画面左下のテキストボックスに指示を入力
2. **指示例**:
   - 「メインサブアイデアにノードを2つ追加して」
   - 「会話の内容をノードに追加する」
   - 「新しいアイデアを提案してください」
3. **実行**: Enterキーまたは「提案」ボタンをクリック
4. **提案確認**: 点線のノード・エッジが表示される
5. **決定**: 「✅ 確定」または「❌ 破棄」を選択

#### 提案の種類
- **ノード追加提案**: 新しいノードと接続を提案
- **会話内容ノード化**: 会話内容を要約したノードを提案
- **汎用提案**: 入力内容に基づく汎用的な提案

### 保存・読み込み操作

#### 保存
1. **保存ボタン**: 左上の「💾 保存」ボタンをクリック
2. **自動ダウンロード**: JSONファイルが自動的にダウンロード
3. **ファイル名**: `マインドマップ_YYYY-MM-DD_HH-MM-SS.json`形式

#### 読み込み
1. **読み込みボタン**: 左上の「📂 読み込み」ボタンをクリック
2. **ファイル選択**: 保存したJSONファイルを選択
3. **自動復元**: マインドマップの状態が完全に復元

### キーボードショートカット
- **Tab**: 選択中のノードにサブノードを追加
- **Ctrl + クリック**: 複数ノード選択
- **Delete**: 選択中のノードを削除

## 🏗️ プロジェクト構造

```
src/
├── components/
│   ├── MindMapRefactored.tsx    # メインのマインドマップコンポーネント
│   ├── ControlPanel.tsx         # 左上のコントロールパネル
│   ├── InfoPanel.tsx           # 右上の情報パネル
│   ├── AiAssistant.tsx         # 左下のAIアシスタント
│   └── CustomNode.tsx          # カスタムノードコンポーネント
├── hooks/
│   ├── useMindMap.ts           # マインドマップの状態管理
│   ├── useAiAssistant.ts       # AI連携機能
│   └── useKeyboardShortcuts.ts # キーボードショートカット
├── App.tsx                     # アプリケーションのエントリーポイント
└── main.tsx                    # Reactアプリケーションの初期化
```

## 🔧 カスタムフック詳細

### useMindMap
マインドマップの状態管理を担当するカスタムフック

**主要機能**:
- ノード・エッジの状態管理
- 選択状態の管理
- レイアウトスタイルの管理
- 保存・読み込み機能
- AI提案の管理（追加、確定、破棄）

**主要メソッド**:
```typescript
const {
  nodes, edges,                    // ノード・エッジの状態
  selectedNodes, selectedEdges,    // 選択状態
  layoutStyle, selectedNodeColor,  // 設定
  addNode, addSubNodes,           // ノード操作
  saveMindMap, openFileDialog,    // 保存・読み込み
  addProposalNodes,               // AI提案ノード追加
  acceptProposal, rejectProposal, // AI提案の確定/破棄
  // ... その他のメソッド
} = useMindMap();
```

### useAiAssistant
AI連携機能を管理するカスタムフック

**主要機能**:
- 自然言語入力の処理
- AI提案の生成（現在はシミュレーション）
- 提案の確定/破棄処理
- 処理状態の管理

**主要インターフェース**:
```typescript
interface AiProposal {
  id: string;           // 提案の一意識別子
  nodes: Node[];        // 提案するノード
  edges: Edge[];        // 提案するエッジ
  description: string;  // 提案の説明
  timestamp: number;    // 提案生成時刻
}
```

**使用方法**:
```typescript
const { 
  aiInput, setAiInput, handleAiInput,
  isProcessing, currentProposal,
  handleAcceptProposal, handleRejectProposal
} = useAiAssistant(
  nodes, edges,                    // 現在のノード・エッジ
  addProposalNodes,               // 提案ノード追加関数
  acceptProposal, rejectProposal  // 提案確定/破棄関数
);
```

### useKeyboardShortcuts
キーボードショートカットを管理するカスタムフック

**対応キー**:
- Tab: サブノード追加
- Ctrl: 複数選択モード

## 🎨 UI/UX デザイン

### デザインコンセプト
- **モダンなガラスモーフィズム**: 半透明背景とブラー効果
- **直感的な操作**: アイコンと視覚的フィードバック
- **レスポンシブデザイン**: 様々な画面サイズに対応
- **アクセシビリティ**: キーボード操作とスクリーンリーダー対応

### カラーパレット
- **プライマリ**: 緑系（#4CAF50, #10B981）
- **セカンダリ**: 青系（#2196F3, #8B5CF6）
- **アクセント**: オレンジ系（#FF9800, #ff6b6b）
- **背景**: 白系（rgba(255,255,255,0.95)）

### アニメーション
- **ホバーエフェクト**: ボタンの浮き上がり効果
- **トランジション**: スムーズな状態変化
- **フィードバック**: 操作結果の視覚的確認
- **処理中インジケーター**: スピナーアニメーション

## 🚀 開発・デプロイ

### 開発環境
```bash
# 開発サーバー起動
npm run dev

# ビルド
npm run build

# プレビュー
npm run preview

# 型チェック
npm run type-check
```

### デプロイ
```bash
# 本番ビルド
npm run build

# 静的ファイルをデプロイ
# dist/ フォルダの内容をWebサーバーに配置
```

## 🐛 トラブルシューティング

### よくある問題

#### 保存機能が動作しない
1. **ブラウザのコンソール**を確認
2. **ポップアップブロッカー**を無効化
3. **ダウンロードフォルダ**の設定を確認

#### AI機能が動作しない
1. **APIキー**が正しく設定されているか確認
2. **ネットワーク接続**を確認
3. **OpenAI API**の利用制限を確認

#### 提案が表示されない
1. **入力内容**が適切か確認
2. **処理中状態**を確認
3. **ブラウザのコンソール**でエラーを確認

#### パフォーマンスの問題
1. **大量のノード**がある場合は、ノード数を削減
2. **ブラウザのメモリ使用量**を確認
3. **不要なノード**を削除

### エラーログ
開発者ツールのコンソールでエラーログを確認できます。

## 📝 ライセンス

MIT License

## 🤝 コントリビューション

1. このリポジトリをフォーク
2. 機能ブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

## 📞 サポート

問題や質問がある場合は、GitHubのIssuesページで報告してください。

---

**AI連携マインドマップエディタ** - アイデアを視覚化し、AIの力を借りて拡張する次世代のマインドマップツール
