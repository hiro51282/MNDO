# AI連携マインドマップエディタ

React + ReactFlow + TypeScriptで構築された、AI機能を備えたマインドマップエディタです。

## 🚀 機能一覧

### 基本操作
- **ノード追加**: ランダムな位置に新しいノードを追加
- **ノード編集**: ダブルクリックでノードのテキストを編集
- **ノード削除**: 右クリックメニューからノードを削除
- **複数選択**: Ctrl+クリックで複数のノードを選択
- **エッジ接続**: ノード間を手動でエッジ接続

### 子ノード生成
- **TABキー**: 選択したノードに子ノードを生成（下/右方向）
- **Shift+TAB**: 選択したノードに子ノードを生成（上/左方向）
- **ボタン操作**: 「サブノード追加」ボタンで子ノード生成
- **AI対話**: 自然言語で指定したノードに子ノードを生成

### レイアウト設定
- **生成スタイル**: 縦方向/横方向の切り替え
- **縦方向**: 子ノードが親ノードの下に配置
- **横方向**: 子ノードが親ノードの右に配置
- **エッジ接続**: レイアウトに応じた適切なエッジ接続

### ノードスタイル
- **色変更**: 選択したノードの色を一括変更
- **選択ハイライト**: 選択中のノードは薄い青でハイライト
- **右クリックメニュー**:
  - 背景色の変更
  - 枠線色の変更
  - 枠線スタイル（実線/破線/点線）
  - フォントサイズ（小/中/大/特大）

### エッジスタイル
- **個別選択**: エッジをクリックして個別に選択
- **複数選択**: Ctrl+クリックで複数のエッジを選択
- **スタイル変更**:
  - 通常線
  - 破線
  - 点線

### AI機能
- **自然言語入力**: 「＜ノード名＞に子ノードを生成してください」
- **自動検索**: 指定されたノードを自動検索
- **自動生成**: 現在の生成スタイルに応じて子ノードを生成

## 🎨 UI構成

### 左上コントロールパネル
```
┌─────────────────────────────────────┐
│ [ノード追加] [サブノード追加 (選択数)] │
│ 生成スタイル: [縦方向 ▼]            │
│ ノード色: [■] [色変更 (選択数)]      │
│ エッジスタイル: [通常線][破線][点線]  │
└─────────────────────────────────────┘
```

### 右上情報パネル
```
┌─────────────────────────┐
│ 選択されたノード: X個    │
│ 選択されたエッジ: X個    │
│ TABキー: サブノード作成  │
│ Shift+TAB: 逆方向作成    │
│ Ctrl+クリック: 複数選択  │
│ 生成スタイル: 縦/横方向  │
└─────────────────────────┘
```

### 左下AIアシスタント
```
┌─────────────────────────────────────┐
│ AI アシスタント                     │
│ 例: 「メインアイデア」に子ノードを生成 │
│ [＜ノード名＞に子ノードを生成してください] [実行] │
└─────────────────────────────────────┘
```

### 右下コントロール
- **ReactFlow Controls**: ズームイン/アウト、フィットビュー
- **MiniMap**: 全体マップ表示

## ⌨️ キーボードショートカット

| キー | 機能 |
|------|------|
| `TAB` | 選択ノードに子ノード生成（下/右方向） |
| `Shift + TAB` | 選択ノードに子ノード生成（上/左方向） |
| `Ctrl + クリック` | 複数選択 |
| `Enter` | AIアシスタント実行 |
| `Enter` | ノード編集確定 |
| `Escape` | ノード編集キャンセル |

## 🎯 使用方法

### 基本的なマインドマップ作成
1. 「ノード追加」ボタンでメインノードを作成
2. ノードをダブルクリックしてテキストを編集
3. ノードを選択してTABキーで子ノードを生成
4. 右クリックメニューでスタイルをカスタマイズ

### 複数ノードの操作
1. Ctrl+クリックで複数のノードを選択
2. カラーピッカーで色を選択
3. 「色変更」ボタンで一括色変更
4. TABキーで複数の子ノードを同時生成

### AI機能の活用
1. 左下のAIアシスタントに「＜ノード名＞に子ノードを生成してください」と入力
2. Enterキーまたは「実行」ボタンをクリック
3. 指定されたノードに自動的に子ノードが生成される

### レイアウトの切り替え
1. 左上の「生成スタイル」ドロップダウンで縦/横方向を選択
2. 以降の子ノード生成は選択したスタイルで実行される

---

## 🛠️ 技術仕様

### アーキテクチャ
- **設計パターン**: カスタムフック + コンポーネント分割
- **状態管理**: React Hooks (useState, useCallback, useEffect)
- **関心の分離**: ロジックとUIの明確な分離

### カスタムフック
- **`useMindMap`**: マインドマップの主要ロジック
  - ノード・エッジの状態管理
  - 子ノード生成ロジック
  - スタイル変更機能
  - 選択状態管理
- **`useAiAssistant`**: AI機能のロジック
  - 自然言語解析
  - ノード検索
  - 自動生成処理
- **`useKeyboardShortcuts`**: キーボードイベント管理
  - TAB/Shift+TABの処理
  - イベントリスナーの管理

### コンポーネント構成
- **`MindMapRefactored`**: メインコンポーネント（シンプル化）
  - 各フックの統合
  - レイアウト管理
- **`ControlPanel`**: 左上コントロールパネル
  - ノード追加・子ノード生成
  - レイアウト設定
  - スタイル変更
- **`InfoPanel`**: 右上情報パネル
  - 選択状態表示
  - 操作ガイド
- **`AiAssistant`**: 左下AIアシスタント
  - 自然言語入力
  - 実行ボタン
- **`CustomNode`**: カスタムノード
  - 編集機能
  - 右クリックメニュー
  - スタイル適用

### ファイル構造
```
src/
├── hooks/                    # カスタムフック
│   ├── useMindMap.ts        # マインドマップロジック
│   ├── useAiAssistant.ts    # AI機能ロジック
│   └── useKeyboardShortcuts.ts # キーボードショートカット
├── components/              # UIコンポーネント
│   ├── MindMapRefactored.tsx # メインコンポーネント
│   ├── ControlPanel.tsx     # コントロールパネル
│   ├── InfoPanel.tsx        # 情報パネル
│   ├── AiAssistant.tsx      # AIアシスタント
│   └── CustomNode.tsx       # カスタムノード
├── App.tsx                  # アプリケーションルート
└── main.tsx                 # エントリーポイント
```

### 技術スタック
- **フレームワーク**: React 18 + TypeScript
- **ビルドツール**: Vite
- **グラフライブラリ**: ReactFlow
- **スタイリング**: TailwindCSS
- **状態管理**: React Hooks

### リファクタリング効果
- **可読性向上**: 各ファイルが単一の責任を持つ
- **保守性向上**: 機能ごとに独立して修正可能
- **拡張性向上**: 新しい機能の追加が容易
- **テスト容易性**: 各フックとコンポーネントを個別にテスト可能

## 🚀 開発環境のセットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# ビルド
npm run build
```

## 🔮 今後の拡張予定

- [ ] GPT APIとの連携
- [ ] マインドマップの保存/読み込み機能
- [ ] エクスポート機能（PNG, PDF）
- [ ] テーマ機能
- [ ] コラボレーション機能
- [ ] 履歴管理機能

## 📝 ライセンス

MIT License
